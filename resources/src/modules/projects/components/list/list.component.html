<div fxLayout="row" fxLayoutAlign="center start">
    <mat-card [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.gt-md]="100" class="card-scroll">
        <mat-progress-bar mode="indeterminate" *ngIf="pending$ | async"></mat-progress-bar>

        <div fxLayout="row" fxLayoutAlign="space-between">
            <mat-card-header fxFlex="0 0 auto">
                <mat-card-title>Projects</mat-card-title>
                <mat-card-subtitle>Administrator</mat-card-subtitle>
            </mat-card-header>

            <mat-card-actions fxFlex="0 0 auto">
                <button mat-icon-button (click)="refresh()">
                    <mat-icon>refresh</mat-icon>
                </button>

                <mat-menu #appMenu="matMenu">
                    <button mat-menu-item>
                        <mat-icon>rss_feed</mat-icon>
                        Atom
                    </button>
                    <button mat-menu-item>
                        <mat-icon>file_download</mat-icon>
                        CSV
                    </button>
                    <button mat-menu-item>
                        <mat-icon>file_download</mat-icon>
                        PDF
                    </button>
                </mat-menu>
                <button mat-icon-button [matMenuTriggerFor]="appMenu">
                    <mat-icon>more_vert</mat-icon>
                </button>
            </mat-card-actions>
        </div>

        <mat-card-content>

            <mat-form-field class="chip-list">
                <mat-chip-list #chipList>
                    <mat-chip
                            *ngFor="let tag of tags"
                            [selectable]="selectable"
                            [removable]="removable"
                            (removed)="remove(tag)">
                        {{getTagLabel(tag)}}
                        <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                    </mat-chip>
                    <input
                            placeholder="Filter projects..."
                            #tagInput
                            [formControl]="tagCtrl"
                            [matAutocomplete]="auto"
                            [matChipInputFor]="chipList"
                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                            [matChipInputAddOnBlur]="addOnBlur"
                            (matChipInputTokenEnd)="add($event)">
                </mat-chip-list>
                <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                    <mat-option *ngFor="let tag of filteredTags | async" [value]="getTagLabel(tag)">
                        {{getTagLabel(tag)}}
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>

            <div class="card-scroll-container">
                <table mat-table [dataSource]="projects" matSort>
                    <ng-container matColumnDef="identifier">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Identifier</th>
                        <td mat-cell *matCellDef="let row" (click)="onSelectProject(row)">
                            <button mat-mini-fab color="primary" [title]="row.identifier">
                                {{row.identifier | slice:0:1 | uppercase}}
                            </button>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="labels">
                        <th mat-header-cell *matHeaderCellDef>Labels</th>
                        <td mat-cell *matCellDef="let row">
                            <button mat-stroked-button class="button-label"
                                    (click)="selectedLabel(statusName[row.status])">
                                {{statusName[row.status]}}
                            </button>
                            <button mat-stroked-button class="button-label" color="warn" *ngIf="row.is_my">
                                Member
                            </button>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
                        <td mat-cell *matCellDef="let row" (click)="onSelectProject(row)">{{row.name}}</td>
                    </ng-container>
                    <ng-container matColumnDef="description">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
                        <td mat-cell *matCellDef="let row" (click)="onSelectProject(row)">
                            {{row.description | slice:0:30}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="manage">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let row">
                            <mat-menu #appMenu="matMenu">
                                <a mat-menu-item [routerLink]="['/projects', row.identifier]">
                                    <mat-icon>open_in_browser</mat-icon>
                                    Open
                                </a>
                                <mat-divider></mat-divider>
                                <button mat-menu-item>
                                    Overview
                                </button>
                            </mat-menu>
                            <button mat-icon-button [matMenuTriggerFor]="appMenu">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
            </div>
        </mat-card-content>

        <mat-paginator [length]="resultsLength"
                       [pageSize]="pageSize"
                       [pageSizeOptions]="pageSizeOptions"
                       (page)="onPageChange($event)">
        </mat-paginator>
    </mat-card>
</div>

<div class="container mt-3">
    <mat-card class="content-card">
        <mat-progress-bar
            mode="indeterminate"
            *ngIf="(pending$ | async)"
        ></mat-progress-bar>
        <div *ngIf="(item$ | async) as item">
            <mat-card-header>
                <mat-card-title>{{ item.subject }}</mat-card-title>
                <button mat-icon-button (click)="load(item.id)">
                    <mat-icon>refresh</mat-icon>
                </button>
                <mat-menu #appMenu="matMenu">
                    <a mat-menu-item routerLink="/issues/{{ item.id }}/edit">
                        <mat-icon>open_in_browser</mat-icon>
                        Edit
                    </a>
                    <a mat-menu-item>
                        <mat-icon>mode_edit</mat-icon>
                        Copy
                    </a>
                    <a
                        mat-menu-item
                        (click)="
                            item.is_watcheble
                                ? unwatch(item.id)
                                : watch(item.id)
                        "
                    >
                        <mat-icon>{{
                            item.is_watcheble ? 'star' : 'star_border'
                        }}</mat-icon>
                        {{ item.is_watcheble ? 'Unwatch' : 'Watch' }}
                    </a>
                    <a mat-menu-item>
                        <mat-icon>delete</mat-icon>
                        Delete
                    </a>
                </mat-menu>
                <button mat-icon-button [matMenuTriggerFor]="appMenu">
                    <mat-icon>more_vert</mat-icon>
                </button>
            </mat-card-header>
            <mat-card-content>
                <div>
                    <mat-icon>info</mat-icon>
                    <div>{{ item.tracker.name }} #{{ item.id }}</div>
                </div>

                <div>
                    <mat-icon>sort</mat-icon>
                    <div>{{ item.priority.name }}</div>
                </div>

                <div *ngIf="item.author">
                    <mat-icon>create</mat-icon>
                    <div>
                        <img src="{{ item.author.avatar }}" />
                        <a href="user/{{ item.author.id }}">
                            {{ item.author.full_name }}
                        </a>
                    </div>
                </div>

                <div *ngIf="item.assigned">
                    <mat-icon>people</mat-icon>
                    <div>
                        <img src="{{ item.assigned.avatar }}" />
                        <a href="user/{{ item.assigned.id }}">
                            {{ item.assigned.full_name }}
                        </a>
                    </div>
                </div>

                <div>
                    <mat-icon>date_range</mat-icon>
                    <div>
                        {{ item.created_on }}
                    </div>
                </div>

                <div *ngIf="item.description">
                    <mat-icon>short_text</mat-icon>
                    <div>
                        <markdown [data]="item.description"></markdown>
                    </div>
                </div>

                <div *ngIf="item.attachments && item.attachments.length">
                    <mat-icon>attachment</mat-icon>
                    <div>
                        <ul>
                            <li *ngFor="let item of item.attachments">
                                {{ item.filename }} ({{ item.filesize }})
                                <a href="user/{{ item.author.id }}">
                                    {{ item.author.full_name }} </a
                                >,
                                {{ item.author.created_on }}
                            </li>
                        </ul>
                    </div>
                </div>
                <div *ngIf="item.journals && item.journals.length">
                    <mat-icon>history</mat-icon>
                    <app-issues-journals
                        [journals]="item.journals"
                    ></app-issues-journals>
                </div>
            </mat-card-content>
        </div>
    </mat-card>
</div>

<div fxLayout="row" fxLayoutAlign="center start">
    <mat-card [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.gt-md]="100">
        <mat-progress-bar mode="indeterminate" *ngIf="pending$ | async"></mat-progress-bar>
        <div *ngIf="item$ | async as item">
            <mat-card-header>
                <mat-card-title>{{item.subject}}</mat-card-title>
                <div fxFlex="100"></div>
                <button mat-icon-button (click)="load(item.id)">
                    <mat-icon>refresh</mat-icon>
                </button>

                <mat-menu #appMenu="matMenu">
                    <a mat-menu-item routerLink="/issues/{{item.id}}/edit">
                        <mat-icon>open_in_browser</mat-icon>
                        Edit
                    </a>
                    <a mat-menu-item>
                        <mat-icon>mode_edit</mat-icon>
                        Copy
                    </a>
                    <a mat-menu-item (click)="item.is_watcheble ? unwatch(item.id) : watch(item.id)">
                        <mat-icon>{{ item.is_watcheble ? 'star' : 'star_border' }}</mat-icon>
                        {{ item.is_watcheble ? 'Unwatch' : 'Watch' }}
                    </a>
                    <a mat-menu-item>
                        <mat-icon>delete</mat-icon>
                        Delete
                    </a>
                </mat-menu>
                <button mat-icon-button [matMenuTriggerFor]="appMenu">
                    <mat-icon>more_vert</mat-icon>
                </button>
            </mat-card-header>
            <mat-card-content fxLayout="column" fxLayoutGap="10px">
                <div fxLayoutGap="30px">
                    <mat-icon>info</mat-icon>
                    <div fxFlex="100">{{item.tracker.name}} #{{item.id}}</div>
                </div>

                <div fxLayoutGap="30px">
                    <mat-icon>sort</mat-icon>
                    <div fxFlex="100">{{item.priority.name}}</div>
                </div>

                <div fxLayoutGap="30px" *ngIf="item.author">
                    <mat-icon>create</mat-icon>
                    <div fxFlex="100">
                        <img src="{{item.author ? item.author.avatar : item.author.avatar}}">
                        <a href="user/{{item.author.id}}">{{item.author.full_name}}</a>
                    </div>
                </div>

                <div fxLayoutGap="30px" *ngIf="item.assigned">
                    <mat-icon>people</mat-icon>
                    <div fxFlex="100">
                        <img src="{{item.assigned ? item.assigned.avatar : item.assigned.avatar}}">
                        <a href="user/{{item.assigned.id}}">{{item.assigned.full_name}}</a>
                    </div>
                </div>

                <div fxLayoutGap="30px">
                    <mat-icon>date_range</mat-icon>
                    <div fxFlex="100">
                        {{item.created_on}}
                    </div>
                </div>

                <div fxLayoutGap="30px" *ngIf="item.description">
                    <mat-icon>short_text</mat-icon>
                    <div fxFlex="100">
                        <markdown [data]="item.description"></markdown>
                    </div>
                </div>

                <div fxLayoutGap="30px" *ngIf="item.attachments && item.attachments.length">
                    <mat-icon>attachment</mat-icon>
                    <div fxFlex="100">
                        <ul>
                            <li *ngFor="let item of item.attachments">
                                {{item.filename}} ({{item.filesize}}) <a href="user/{{item.author.id}}">{{item.author.full_name}}</a>,
                                {{item.author.created_on}}
                            </li>
                        </ul>
                    </div>
                </div>
                <div fxLayout fxLayoutGap="30px" *ngIf="item.journals && item.journals.length">
                    <mat-icon>history</mat-icon>
                    <app-issues-journals [journals]="item.journals"></app-issues-journals>
                </div>
            </mat-card-content>
        </div>
    </mat-card>
</div>